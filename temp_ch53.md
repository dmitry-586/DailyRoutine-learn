# ╨ô╨╗╨░╨▓╨░ 53. TanStack Query: useQuery, ╨║╤ì╤ê╨╕╤Ç╨╛╨▓╨░╨╜╨╕╨╡ ╨╕ query keys

TanStack Query (╤Ç╨░╨╜╨╡╨╡ React Query) ΓÇö ╤ü╤é╨░╨╜╨┤╨░╤Ç╤é ╨┤╨╗╤Å ╤â╨┐╤Ç╨░╨▓╨╗╨╡╨╜╨╕╤Å ╤ü╨╡╤Ç╨▓╨╡╤Ç╨╜╤ï╨╝ ╤ü╨╛╤ü╤é╨╛╤Å╨╜╨╕╨╡╨╝ ╨▓ React. ╨ƒ╨╛╨╜╨╕╨╝╨░╨╜╨╕╨╡ `useQuery`, ╨║╤ì╤ê╨╕╤Ç╨╛╨▓╨░╨╜╨╕╤Å ╨╕ query keys ╨║╤Ç╨╕╤é╨╕╤ç╨╜╨╛ ╨┤╨╗╤Å ╤ì╤ä╤ä╨╡╨║╤é╨╕╨▓╨╜╨╛╨╣ ╤Ç╨░╨▒╨╛╤é╤ï ╤ü API.

---

## 53.1. ╨ú╤ü╤é╨░╨╜╨╛╨▓╨║╨░ ╨╕ ╨╜╨░╤ü╤é╤Ç╨╛╨╣╨║╨░

TanStack Query ╤é╤Ç╨╡╨▒╤â╨╡╤é ╨╛╨▒╤æ╤Ç╤é╨║╨╕ `QueryClientProvider` ╨╜╨░ ╨▓╨╡╤Ç╤à╨╜╨╡╨╝ ╤â╤Ç╨╛╨▓╨╜╨╡ ╨┐╤Ç╨╕╨╗╨╛╨╢╨╡╨╜╨╕╤Å. ╨Æ ╨╜╨╡╨╣ ╨╜╨░╤ü╤é╤Ç╨░╨╕╨▓╨░╤Ä╤é╤ü╤Å ╨│╨╗╨╛╨▒╨░╨╗╤î╨╜╤ï╨╡ ╨┐╨░╤Ç╨░╨╝╨╡╤é╤Ç╤ï:

- **staleTime** ΓÇö ╨║╨░╨║ ╨┤╨╛╨╗╨│╨╛ ╨┤╨░╨╜╨╜╤ï╨╡ ╤ü╤ç╨╕╤é╨░╤Ä╤é╤ü╤Å ╨░╨║╤é╤â╨░╨╗╤î╨╜╤ï╨╝╨╕ (0 ╨┐╨╛ ╤â╨╝╨╛╨╗╤ç╨░╨╜╨╕╤Ä ΓÇö ╨┤╨░╨╜╨╜╤ï╨╡ ╤â╤ü╤é╨░╤Ç╨╡╨▓╨░╤Ä╤é ╨╝╨│╨╜╨╛╨▓╨╡╨╜╨╜╨╛)
- **gcTime** ΓÇö ╨║╨░╨║ ╨┤╨╛╨╗╨│╨╛ ╤à╤Ç╨░╨╜╨╕╤é╤î ╨╜╨╡╨╕╤ü╨┐╨╛╨╗╤î╨╖╤â╨╡╨╝╤ï╨╡ ╨┤╨░╨╜╨╜╤ï╨╡ ╨▓ ╨║╤ì╤ê╨╡ (5 ╨╝╨╕╨╜╤â╤é ╨┐╨╛ ╤â╨╝╨╛╨╗╤ç╨░╨╜╨╕╤Ä)
- **retry** ΓÇö ╤ü╨║╨╛╨╗╤î╨║╨╛ ╤Ç╨░╨╖ ╨┐╨╛╨▓╤é╨╛╤Ç╤Å╤é╤î ╨╖╨░╨┐╤Ç╨╛╤ü ╨┐╤Ç╨╕ ╨╛╤ê╨╕╨▒╨║╨╡
- **refetchOnWindowFocus** ΓÇö ╨╛╨▒╨╜╨╛╨▓╨╗╤Å╤é╤î ╨╗╨╕ ╨┤╨░╨╜╨╜╤ï╨╡ ╨┐╤Ç╨╕ ╨▓╨╛╨╖╨▓╤Ç╨░╤é╨╡ ╨╜╨░ ╨▓╨║╨╗╨░╨┤╨║╤â

```bash
npm install @tanstack/react-query
```

**╨Æ╨░╨╢╨╜╨╛:** ╨▓ TanStack Query v5 `cacheTime` ╨┐╨╡╤Ç╨╡╨╕╨╝╨╡╨╜╨╛╨▓╨░╨╜ ╨▓ **`gcTime`** (Garbage Collection Time). ╨¡╤é╨╛ ╨║╤Ç╨╕╤é╨╕╤ç╨╡╤ü╨║╨╕ ╨▓╨░╨╢╨╜╨╛ ╨┤╨╗╤Å ╤ü╨╛╨▒╨╡╤ü╨╡╨┤╨╛╨▓╨░╨╜╨╕╨╣.

╨ö╨╛╨▒╨░╨▓╤î╤é╨╡ `QueryClientProvider` ╨▓ ╨║╨╛╤Ç╨╜╨╡╨▓╨╛╨╣ layout ╨╕ ╨╜╨░╤ü╤é╤Ç╨╛╨╣╤é╨╡ `QueryClient` ╨┐╨╛╨┤ ╨╜╤â╨╢╨┤╤ï ╨┐╤Ç╨╛╨╡╨║╤é╨░.

---

## 53.2. useQuery: ╨┐╨╛╨╗╤â╤ç╨╡╨╜╨╕╨╡ ╨┤╨░╨╜╨╜╤ï╤à

### ╨æ╨░╨╖╨╛╨▓╨╛╨╡ ╨╕╤ü╨┐╨╛╨╗╤î╨╖╨╛╨▓╨░╨╜╨╕╨╡

**╨Æ╨░╨╢╨╜╨╛:** ╨▓ TanStack Query v5 ╨┐╨╛╨┤╨┤╨╡╤Ç╨╢╨╕╨▓╨░╨╡╤é╤ü╤Å ╤é╨╛╨╗╤î╨║╨╛ **╨╛╨▒╤è╨╡╨║╤é╨╜╤ï╨╣ ╤ä╨╛╤Ç╨╝╨░╤é** ╨┐╨░╤Ç╨░╨╝╨╡╤é╤Ç╨╛╨▓. ╨í╤é╨░╤Ç╤ï╨╣ ╤ü╨╕╨╜╤é╨░╨║╤ü╨╕╤ü `useQuery(queryKey, queryFn, options)` ╨▒╨╛╨╗╤î╤ê╨╡ ╨╜╨╡ ╤Ç╨░╨▒╨╛╤é╨░╨╡╤é.

```typescript
import { useQuery } from '@tanstack/react-query'
import { apiClient } from '@/lib/api/axios'

interface User {
  id: number
  name: string
  email: string
}

export function UsersList() {
  const { data, isPending, error } = useQuery({
    queryKey: ['users'],
    queryFn: async () => {
      const { data } = await apiClient.get<User[]>('/users')
      return data
    },
  })

  if (isPending) return <div>Loading...</div>
  if (error) return <div>Error: {error.message}</div>

  return (
    <ul>
      {data?.map((user) => (
        <li key={user.id}>{user.name}</li>
      ))}
    </ul>
  )
}
```

### ╨í╨╛╤ü╤é╨╛╤Å╨╜╨╕╤Å ╨╖╨░╨┐╤Ç╨╛╤ü╨░

`useQuery` ╨▓╨╛╨╖╨▓╤Ç╨░╤ë╨░╨╡╤é ╨╛╨▒╤è╨╡╨║╤é ╤ü ╨╜╨╡╤ü╨║╨╛╨╗╤î╨║╨╕╨╝╨╕ ╨▓╨░╨╢╨╜╤ï╨╝╨╕ ╤ü╨▓╨╛╨╣╤ü╤é╨▓╨░╨╝╨╕:

- **isPending** ΓÇö ╨┐╨╡╤Ç╨▓╨░╤Å ╨╖╨░╨│╤Ç╤â╨╖╨║╨░ (╨┤╨░╨╜╨╜╤ï╤à ╨╡╤ë╤æ ╨╜╨╡╤é ╨▓ ╨║╤ì╤ê╨╡) ΓÇö **╨╜╨╛╨▓╨╛╨╡ ╨▓ v5, ╨╖╨░╨╝╨╡╨╜╨╕╨╗╨╛ `isLoading`**
- **isFetching** ΓÇö ╨╗╤Ä╨▒╨░╤Å ╨╖╨░╨│╤Ç╤â╨╖╨║╨░, ╨▓╨║╨╗╤Ä╤ç╨░╤Å ╤ä╨╛╨╜╨╛╨▓╤â╤Ä (╨┤╨░╨╜╨╜╤ï╨╡ ╤â╨╢╨╡ ╨╡╤ü╤é╤î)
- **isSuccess** ΓÇö ╨╖╨░╨┐╤Ç╨╛╤ü ╤â╤ü╨┐╨╡╤ê╨╜╨╛ ╨╖╨░╨▓╨╡╤Ç╤ê╤æ╨╜
- **isError** ΓÇö ╨┐╤Ç╨╛╨╕╨╖╨╛╤ê╨╗╨░ ╨╛╤ê╨╕╨▒╨║╨░
- **refetch** ΓÇö ╤ä╤â╨╜╨║╤å╨╕╤Å ╨┤╨╗╤Å ╤Ç╤â╤ç╨╜╨╛╨│╨╛ ╨╛╨▒╨╜╨╛╨▓╨╗╨╡╨╜╨╕╤Å

**╨Æ╨░╨╢╨╜╨╛╨╡ ╤Ç╨░╨╖╨╗╨╕╤ç╨╕╨╡:** `isPending` ╨┐╨╛╨║╨░╨╖╤ï╨▓╨░╨╡╤é ╤ü╨║╨╡╨╗╨╡╤é╨╛╨╜ ╨┐╤Ç╨╕ ╨┐╨╡╤Ç╨▓╨╛╨╝ ╨╖╨░╤à╨╛╨┤╨╡ (╨║╨╛╨│╨┤╨░ ╨┤╨░╨╜╨╜╤ï╤à ╨╜╨╡╤é ╨▓ ╨║╤ì╤ê╨╡). `isFetching` ╨┐╨╛╨║╨░╨╖╤ï╨▓╨░╨╡╤é ╤ü╨┐╨╕╨╜╨╜╨╡╤Ç ╨┐╤Ç╨╕ ╨╛╨▒╨╜╨╛╨▓╨╗╨╡╨╜╨╕╨╕ ╤â╨╢╨╡ ╨╖╨░╨│╤Ç╤â╨╢╨╡╨╜╨╜╤ï╤à ╨┤╨░╨╜╨╜╤ï╤à. ╨¡╤é╨╛ ╨┐╨╛╨╖╨▓╨╛╨╗╤Å╨╡╤é ╨╜╨╡ ╨┐╤Ç╤Å╤é╨░╤é╤î ╨║╨╛╨╜╤é╨╡╨╜╤é ╨┐╤Ç╨╕ ╤ä╨╛╨╜╨╛╨▓╨╛╨╝ ╨╛╨▒╨╜╨╛╨▓╨╗╨╡╨╜╨╕╨╕.

**Breaking Change v5:** `isLoading` ╨┐╨╡╤Ç╨╡╨╕╨╝╨╡╨╜╨╛╨▓╨░╨╜ ╨▓ `isPending` ╨┤╨╗╤Å ╨▒╨╛╨╗╨╡╨╡ ╤é╨╛╤ç╨╜╨╛╨│╨╛ ╨╛╨┐╨╕╤ü╨░╨╜╨╕╤Å ╤ü╨╛╤ü╤é╨╛╤Å╨╜╨╕╤Å (╨┤╨░╨╜╨╜╤ï╨╡ ╨╝╨╛╨│╤â╤é ╨▒╤ï╤é╤î ╨▓ ╨║╤ì╤ê╨╡, ╨╜╨╛ ╨╖╨░╨┐╤Ç╨╛╤ü ╨╡╤ë╤æ ╨▓╤ï╨┐╨╛╨╗╨╜╤Å╨╡╤é╤ü╤Å).

---

## 53.3. Query Keys: ╤ä╨░╨▒╤Ç╨╕╨║╨░ ╨║╨╗╤Ä╤ç╨╡╨╣

**Query Key** ΓÇö ╤â╨╜╨╕╨║╨░╨╗╤î╨╜╤ï╨╣ ╨╕╨┤╨╡╨╜╤é╨╕╤ä╨╕╨║╨░╤é╨╛╤Ç ╨╖╨░╨┐╤Ç╨╛╤ü╨░. ╨₧╤é ╨╜╨╡╨│╨╛ ╨╖╨░╨▓╨╕╤ü╨╕╤é ╨║╨╡╤ê╨╕╤Ç╨╛╨▓╨░╨╜╨╕╨╡ ╨╕ ╨╕╨╜╨▓╨░╨╗╨╕╨┤╨░╤å╨╕╤Å ╨┤╨░╨╜╨╜╤ï╤à.

**╨ù╨░╤ç╨╡╨╝ ╨╜╤â╨╢╨╜╨░ ╤ä╨░╨▒╤Ç╨╕╨║╨░ ╨║╨╗╤Ä╤ç╨╡╨╣?**

1. **╨ª╨╡╨╜╤é╤Ç╨░╨╗╨╕╨╖╨╛╨▓╨░╨╜╨╜╨╛╨╡ ╤â╨┐╤Ç╨░╨▓╨╗╨╡╨╜╨╕╨╡** ΓÇö ╨▓╤ü╨╡ ╨║╨╗╤Ä╤ç╨╕ ╨▓ ╨╛╨┤╨╜╨╛╨╝ ╨╝╨╡╤ü╤é╨╡
2. **╨ó╨╛╤ç╨╡╤ç╨╜╨░╤Å ╨╕╨╜╨▓╨░╨╗╨╕╨┤╨░╤å╨╕╤Å** ΓÇö ╨╝╨╛╨╢╨╜╨╛ ╨╛╨▒╨╜╨╛╨▓╨╕╤é╤î ╤é╨╛╨╗╤î╨║╨╛ ╨╜╤â╨╢╨╜╤ï╨╡ ╨┤╨░╨╜╨╜╤ï╨╡
3. **╨ÿ╨╡╤Ç╨░╤Ç╤à╨╕╤Å** ΓÇö ╨╕╨╜╨▓╨░╨╗╨╕╨┤╨░╤å╨╕╤Å `['users']` ╨╛╨▒╨╜╨╛╨▓╨╕╤é ╨▓╤ü╨╡ ╨╖╨░╨┐╤Ç╨╛╤ü╤ï ╨┐╨╛╨╗╤î╨╖╨╛╨▓╨░╤é╨╡╨╗╨╡╨╣
4. **╨ó╨╕╨┐╨╛╨▒╨╡╨╖╨╛╨┐╨░╤ü╨╜╨╛╤ü╤é╤î** ΓÇö TypeScript ╨╖╨░╤ë╨╕╤ë╨░╨╡╤é ╨╛╤é ╨╛╨┐╨╡╤ç╨░╤é╨╛╨║

**╨ƒ╤Ç╨╕╨╜╤å╨╕╨┐ ╨╕╨╡╤Ç╨░╤Ç╤à╨╕╨╕:**

- `['users']` ΓÇö ╨▓╤ü╨╡ ╨┤╨░╨╜╨╜╤ï╨╡ ╨┐╨╛╨╗╤î╨╖╨╛╨▓╨░╤é╨╡╨╗╨╡╨╣
- `['users', 'list']` ΓÇö ╤ü╨┐╨╕╤ü╨║╨╕ ╨┐╨╛╨╗╤î╨╖╨╛╨▓╨░╤é╨╡╨╗╨╡╨╣
- `['users', 'list', 'active']` ΓÇö ╨░╨║╤é╨╕╨▓╨╜╤ï╨╡ ╨┐╨╛╨╗╤î╨╖╨╛╨▓╨░╤é╨╡╨╗╨╕
- `['users', 'detail', 123]` ΓÇö ╨║╨╛╨╜╨║╤Ç╨╡╤é╨╜╤ï╨╣ ╨┐╨╛╨╗╤î╨╖╨╛╨▓╨░╤é╨╡╨╗╤î

╨ƒ╤Ç╨╕ ╨╕╨╜╨▓╨░╨╗╨╕╨┤╨░╤å╨╕╨╕ `['users']` ╨╛╨▒╨╜╨╛╨▓╤Å╤é╤ü╤Å ╨Æ╨í╨ò ╨╖╨░╨┐╤Ç╨╛╤ü╤ï, ╨╜╨░╤ç╨╕╨╜╨░╤Ä╤ë╨╕╨╡╤ü╤Å ╤ü `'users'`. ╨ƒ╤Ç╨╕ ╨╕╨╜╨▓╨░╨╗╨╕╨┤╨░╤å╨╕╨╕ `['users', 'detail', 123]` ΓÇö ╤é╨╛╨╗╤î╨║╨╛ ╨║╨╛╨╜╨║╤Ç╨╡╤é╨╜╤ï╨╣ ╨┐╨╛╨╗╤î╨╖╨╛╨▓╨░╤é╨╡╨╗╤î.

---

## 53.4. ╨Ü╤ì╤ê╨╕╤Ç╨╛╨▓╨░╨╜╨╕╨╡

TanStack Query ╨╕╤ü╨┐╨╛╨╗╤î╨╖╤â╨╡╤é ╤â╨╝╨╜╨╛╨╡ ╨║╨╡╤ê╨╕╤Ç╨╛╨▓╨░╨╜╨╕╨╡ ╤ü ╨┤╨▓╤â╨╝╤Å ╨║╨╗╤Ä╤ç╨╡╨▓╤ï╨╝╨╕ ╨┐╨░╤Ç╨░╨╝╨╡╤é╤Ç╨░╨╝╨╕:

### staleTime ΓÇö ╨▓╤Ç╨╡╨╝╤Å ╨░╨║╤é╤â╨░╨╗╤î╨╜╨╛╤ü╤é╨╕

╨₧╨┐╤Ç╨╡╨┤╨╡╨╗╤Å╨╡╤é, ╨║╨░╨║ ╨┤╨╛╨╗╨│╨╛ ╨┤╨░╨╜╨╜╤ï╨╡ ╤ü╤ç╨╕╤é╨░╤Ä╤é╤ü╤Å ╤ü╨▓╨╡╨╢╨╕╨╝╨╕:

- **╨ö╨░╨╜╨╜╤ï╨╡ ╤ü╨▓╨╡╨╢╨╕╨╡** (< staleTime) ΓÇö ╨╖╨░╨┐╤Ç╨╛╤ü ╨╜╨╡ ╨▓╤ï╨┐╨╛╨╗╨╜╤Å╨╡╤é╤ü╤Å, ╨┤╨░╨╜╨╜╤ï╨╡ ╨╕╨╖ ╨║╨╡╤ê╨░
- **╨ö╨░╨╜╨╜╤ï╨╡ ╤â╤ü╤é╨░╤Ç╨╡╨╗╨╕** (> staleTime) ΓÇö ╨▓╤ï╨┐╨╛╨╗╨╜╤Å╨╡╤é╤ü╤Å ╤ä╨╛╨╜╨╛╨▓╤ï╨╣ ╨╖╨░╨┐╤Ç╨╛╤ü, ╨╜╨╛ UI ╨┐╨╛╨║╨░╨╖╤ï╨▓╨░╨╡╤é ╨║╨╡╤ê╨╕╤Ç╨╛╨▓╨░╨╜╨╜╤ï╨╡ ╨┤╨░╨╜╨╜╤ï╨╡ ╤ü╤Ç╨░╨╖╤â

**╨ƒ╤Ç╨╕╨╝╨╡╤Ç:** `staleTime: 1000 * 60` // ╨┤╨░╨╜╨╜╤ï╨╡ ╤ü╨▓╨╡╨╢╨╕╨╡ 1 ╨╝╨╕╨╜╤â╤é╤â

**╨ƒ╨╛ ╤â╨╝╨╛╨╗╤ç╨░╨╜╨╕╤Ä:** `staleTime: 0` ΓÇö ╨┤╨░╨╜╨╜╤ï╨╡ ╤â╤ü╤é╨░╤Ç╨╡╨▓╨░╤Ä╤é ╨╝╨│╨╜╨╛╨▓╨╡╨╜╨╜╨╛, ╨╜╨╛ ╨╛╤ü╤é╨░╤Ä╤é╤ü╤Å ╨▓ ╨║╨╡╤ê╨╡ ╨┤╨╗╤Å ╨╝╨│╨╜╨╛╨▓╨╡╨╜╨╜╨╛╨│╨╛ ╨╛╤é╨╛╨▒╤Ç╨░╨╢╨╡╨╜╨╕╤Å.

### gcTime ΓÇö ╨▓╤Ç╨╡╨╝╤Å ╤à╤Ç╨░╨╜╨╡╨╜╨╕╤Å ╨▓ ╨║╨╡╤ê╨╡

**Breaking Change v5:** `cacheTime` ╨┐╨╡╤Ç╨╡╨╕╨╝╨╡╨╜╨╛╨▓╨░╨╜ ╨▓ **`gcTime`** (Garbage Collection Time).

╨₧╨┐╤Ç╨╡╨┤╨╡╨╗╤Å╨╡╤é, ╨║╨░╨║ ╨┤╨╛╨╗╨│╨╛ ╤à╤Ç╨░╨╜╨╕╤é╤î ╨╜╨╡╨╕╤ü╨┐╨╛╨╗╤î╨╖╤â╨╡╨╝╤ï╨╡ ╨┤╨░╨╜╨╜╤ï╨╡:

- ╨Ü╨╛╨│╨┤╨░ ╨║╨╛╨╝╨┐╨╛╨╜╨╡╨╜╤é ╤Ç╨░╨╖╨╝╨╛╨╜╤é╨╕╤Ç╤â╨╡╤é╤ü╤Å ΓÇö ╨┤╨░╨╜╨╜╤ï╨╡ ╨╛╤ü╤é╨░╤Ä╤é╤ü╤Å ╨▓ ╨║╨╡╤ê╨╡
- ╨ƒ╤Ç╨╕ ╨┐╨╛╨▓╤é╨╛╤Ç╨╜╨╛╨╝ ╨╝╨╛╨╜╤é╨╕╤Ç╨╛╨▓╨░╨╜╨╕╨╕ ╨▓ ╨┐╤Ç╨╡╨┤╨╡╨╗╨░╤à gcTime ΓÇö ╨┤╨░╨╜╨╜╤ï╨╡ ╨╝╨│╨╜╨╛╨▓╨╡╨╜╨╜╨╛ ╨╕╨╖ ╨║╨╡╤ê╨░
- ╨ƒ╨╛╤ü╨╗╨╡ ╨╕╤ü╤é╨╡╤ç╨╡╨╜╨╕╤Å gcTime ΓÇö ╨┤╨░╨╜╨╜╤ï╨╡ ╤â╨┤╨░╨╗╤Å╤Ä╤é╤ü╤Å ╨╕╨╖ ╨┐╨░╨╝╤Å╤é╨╕

**╨ƒ╤Ç╨╕╨╝╨╡╤Ç:** `gcTime: 10 * 60 * 1000` // ╨┤╨░╨╜╨╜╤ï╨╡ ╤à╤Ç╨░╨╜╤Å╤é╤ü╤Å 10 ╨╝╨╕╨╜╤â╤é ╨┐╨╛╤ü╨╗╨╡ ╤Ç╨░╨╖╨╝╨╛╨╜╤é╨╕╤Ç╨╛╨▓╨░╨╜╨╕╤Å

**╨ƒ╨╛ ╤â╨╝╨╛╨╗╤ç╨░╨╜╨╕╤Ä:** `gcTime: 5 * 60 * 1000` (5 ╨╝╨╕╨╜╤â╤é).

---

## 53.5. ╨Ü╨░╤ü╤é╨╛╨╝╨╜╤ï╨╡ ╤à╤â╨║╨╕

╨ÿ╨╜╨║╨░╨┐╤ü╤â╨╗╨╕╤Ç╤â╨╣╤é╨╡ ╨║╨░╨╢╨┤╤ï╨╣ ╨╖╨░╨┐╤Ç╨╛╤ü ╨▓ ╨╛╤é╨┤╨╡╨╗╤î╨╜╤ï╨╣ ╤à╤â╨║:

```typescript
// hooks/useUsers.ts
import { useQuery } from '@tanstack/react-query'
import { apiClient } from '@/lib/api/axios'
import { queryKeys } from '@/lib/api/query-keys'

interface User {
  id: number
  name: string
  email: string
}

// ╨í╨┐╨╕╤ü╨╛╨║ ╨┐╨╛╨╗╤î╨╖╨╛╨▓╨░╤é╨╡╨╗╨╡╨╣
export const useUsers = (filters?: { status?: string }) => {
  return useQuery({
    queryKey: queryKeys.users.list(JSON.stringify(filters)),
    queryFn: async () => {
      const { data } = await apiClient.get<User[]>('/users', {
        params: filters,
      })
      return data
    },
    staleTime: 5 * 60 * 1000, // ╨ö╨░╨╜╨╜╤ï╨╡ ╨░╨║╤é╤â╨░╨╗╤î╨╜╤ï 5 ╨╝╨╕╨╜╤â╤é
  })
}

// ╨Ü╨╛╨╜╨║╤Ç╨╡╤é╨╜╤ï╨╣ ╨┐╨╛╨╗╤î╨╖╨╛╨▓╨░╤é╨╡╨╗╤î
export const useUser = (id: number) => {
  return useQuery({
    queryKey: queryKeys.users.detail(id),
    queryFn: async () => {
      const { data } = await apiClient.get<User>(`/users/${id}`)
      return data
    },
    enabled: !!id, // ╨ù╨░╨┐╤Ç╨╛╤ü ╤é╨╛╨╗╤î╨║╨╛ ╨╡╤ü╨╗╨╕ id ╤ü╤â╤ë╨╡╤ü╤é╨▓╤â╨╡╤é
  })
}

// ╨ÿ╤ü╨┐╨╛╨╗╤î╨╖╨╛╨▓╨░╨╜╨╕╨╡
function UsersList() {
  const { data: users } = useUsers({ status: 'active' })
  // ...
}

function UserProfile({ id }: { id: number }) {
  const { data: user } = useUser(id)
  // ...
}
```

---

## 53.6. ╨í╨╡╨╗╨╡╨║╤é╨╛╤Ç╤ï ╨┤╨╗╤Å ╨╛╨┐╤é╨╕╨╝╨╕╨╖╨░╤å╨╕╨╕

**╨ƒ╤Ç╨╛╨▒╨╗╨╡╨╝╨░:** ╨┐╨╛ ╤â╨╝╨╛╨╗╤ç╨░╨╜╨╕╤Ä ╨║╨╛╨╝╨┐╨╛╨╜╨╡╨╜╤é ╤Ç╨╡╤Ç╨╡╨╜╨┤╨╡╤Ç╨╕╤é╤ü╤Å ╨┐╤Ç╨╕ ╨╗╤Ä╨▒╨╛╨╝ ╨╕╨╖╨╝╨╡╨╜╨╡╨╜╨╕╨╕ ╨┤╨░╨╜╨╜╤ï╤à ╨╖╨░╨┐╤Ç╨╛╤ü╨░.

**╨á╨╡╤ê╨╡╨╜╨╕╨╡:** ╤ü╨╡╨╗╨╡╨║╤é╨╛╤Ç╤ï ╨┐╨╛╨╖╨▓╨╛╨╗╤Å╤Ä╤é ╨┐╨╛╨┤╨┐╨╕╤ü╨░╤é╤î╤ü╤Å ╤é╨╛╨╗╤î╨║╨╛ ╨╜╨░ ╨╜╤â╨╢╨╜╤â╤Ä ╤ç╨░╤ü╤é╤î ╨┤╨░╨╜╨╜╤ï╤à.

╨ò╤ü╨╗╨╕ ╨║╨╛╨╝╨┐╨╛╨╜╨╡╨╜╤é ╨╕╤ü╨┐╨╛╨╗╤î╨╖╤â╨╡╤é ╤é╨╛╨╗╤î╨║╨╛ email ╨┐╨╛╨╗╤î╨╖╨╛╨▓╨░╤é╨╡╨╗╤Å, ╨╜╨╡╤é ╤ü╨╝╤ï╤ü╨╗╨░ ╤Ç╨╡╤Ç╨╡╨╜╨┤╨╡╤Ç╨╕╤é╤î ╨╡╨│╨╛ ╨┐╤Ç╨╕ ╨╕╨╖╨╝╨╡╨╜╨╡╨╜╨╕╨╕ ╨╕╨╝╨╡╨╜╨╕. ╨í╨╡╨╗╨╡╨║╤é╨╛╤Ç `select: (user) => user.email` ╨┐╨╛╨┤╨┐╨╕╤ü╤ï╨▓╨░╨╡╤é ╨║╨╛╨╝╨┐╨╛╨╜╨╡╨╜╤é ╤é╨╛╨╗╤î╨║╨╛ ╨╜╨░ ╨┐╨╛╨╗╨╡ email.

**╨Ü╨╛╨│╨┤╨░ ╨╕╤ü╨┐╨╛╨╗╤î╨╖╨╛╨▓╨░╤é╤î:**

- ╨Ü╨╛╨╝╨┐╨╛╨╜╨╡╨╜╤é ╨╕╤ü╨┐╨╛╨╗╤î╨╖╤â╨╡╤é ╤é╨╛╨╗╤î╨║╨╛ ╤ç╨░╤ü╤é╤î ╨┤╨░╨╜╨╜╤ï╤à ╨╕╨╖ ╨▒╨╛╨╗╤î╤ê╨╛╨│╨╛ ╨╛╨▒╤è╨╡╨║╤é╨░
- ╨¥╤â╨╢╨╜╨╛ ╨▓╤ï╤ç╨╕╤ü╨╗╨╕╤é╤î ╨┐╤Ç╨╛╨╕╨╖╨▓╨╛╨┤╨╜╨╛╨╡ ╨╖╨╜╨░╤ç╨╡╨╜╨╕╨╡ (╨╜╨░╨┐╤Ç╨╕╨╝╨╡╤Ç, `fullName` ╨╕╨╖ `firstName` + `lastName`)
- ╨₧╨┐╤é╨╕╨╝╨╕╨╖╨░╤å╨╕╤Å ╤ç╨░╤ü╤é╤ï╤à ╤Ç╨╡╤Ç╨╡╨╜╨┤╨╡╤Ç╨╛╨▓

---

## 53.7. ╨Ü╨╛╨╜╤ä╨╕╨│╤â╤Ç╨░╤å╨╕╤Å ╨╖╨░╨┐╤Ç╨╛╤ü╨╛╨▓

### enabled

╨ú╤ü╨╗╨╛╨▓╨╜╨╛╨╡ ╨▓╤ï╨┐╨╛╨╗╨╜╨╡╨╜╨╕╨╡ ╨╖╨░╨┐╤Ç╨╛╤ü╨░:

```typescript
const { data: user } = useQuery({
  queryKey: queryKeys.users.detail(userId),
  queryFn: () => fetchUser(userId),
  enabled: !!userId, // ╨ù╨░╨┐╤Ç╨╛╤ü ╤é╨╛╨╗╤î╨║╨╛ ╨╡╤ü╨╗╨╕ userId ╤ü╤â╤ë╨╡╤ü╤é╨▓╤â╨╡╤é
})
```

### retry

╨¥╨░╤ü╤é╤Ç╨╛╨╣╨║╨░ ╨┐╨╛╨▓╤é╨╛╤Ç╨╜╤ï╤à ╨┐╨╛╨┐╤ï╤é╨╛╨║:

```typescript
useQuery({
  queryKey: ['users'],
  queryFn: fetchUsers,
  retry: 2, // 2 ╨┐╨╛╨┐╤ï╤é╨║╨╕ ╨┐╤Ç╨╕ ╨╛╤ê╨╕╨▒╨║╨╡
  retryDelay: (attemptIndex) => Math.min(1000 * 2 ** attemptIndex, 30000), // Exponential backoff
})
```

### refetchInterval

╨É╨▓╤é╨╛╨╝╨░╤é╨╕╤ç╨╡╤ü╨║╨╛╨╡ ╨╛╨▒╨╜╨╛╨▓╨╗╨╡╨╜╨╕╨╡ ╤ü ╨╕╨╜╤é╨╡╤Ç╨▓╨░╨╗╨╛╨╝:

```typescript
useQuery({
  queryKey: ['notifications'],
  queryFn: fetchNotifications,
  refetchInterval: 30000, // ╨₧╨▒╨╜╨╛╨▓╨╗╤Å╤é╤î ╨║╨░╨╢╨┤╤ï╨╡ 30 ╤ü╨╡╨║╤â╨╜╨┤
})
```

---

## ╨Æ╨╛╨┐╤Ç╨╛╤ü╤ï ╨╜╨░ ╤ü╨╛╨▒╨╡╤ü╨╡╨┤╨╛╨▓╨░╨╜╨╕╨╕

### 1. ╨º╤é╨╛ ╤é╨░╨║╨╛╨╡ query key?

╨ú╨╜╨╕╨║╨░╨╗╤î╨╜╤ï╨╣ ╨╕╨┤╨╡╨╜╤é╨╕╤ä╨╕╨║╨░╤é╨╛╤Ç ╨╖╨░╨┐╤Ç╨╛╤ü╨░, ╨╕╤ü╨┐╨╛╨╗╤î╨╖╤â╨╡╤é╤ü╤Å ╨┤╨╗╤Å ╨║╨╡╤ê╨╕╤Ç╨╛╨▓╨░╨╜╨╕╤Å ╨╕ ╨╕╨╜╨▓╨░╨╗╨╕╨┤╨░╤å╨╕╨╕.

### 2. ╨Æ ╤ç╤æ╨╝ ╤Ç╨░╨╖╨╜╨╕╤å╨░ ╨╝╨╡╨╢╨┤╤â staleTime ╨╕ gcTime?

`staleTime` ΓÇö ╨▓╤Ç╨╡╨╝╤Å ╨░╨║╤é╤â╨░╨╗╤î╨╜╨╛╤ü╤é╨╕ ╨┤╨░╨╜╨╜╤ï╤à. `gcTime` ΓÇö ╨▓╤Ç╨╡╨╝╤Å ╤à╤Ç╨░╨╜╨╡╨╜╨╕╤Å ╨╜╨╡╨╕╤ü╨┐╨╛╨╗╤î╨╖╤â╨╡╨╝╤ï╤à ╨┤╨░╨╜╨╜╤ï╤à ╨▓ ╨║╨╡╤ê╨╡.

### 3. ╨Æ ╤ç╤æ╨╝ ╤Ç╨░╨╖╨╜╨╕╤å╨░ ╨╝╨╡╨╢╨┤╤â isLoading ╨╕ isFetching?

`isLoading` ΓÇö ╨┐╨╡╤Ç╨▓╨░╤Å ╨╖╨░╨│╤Ç╤â╨╖╨║╨░. `isFetching` ΓÇö ╨╗╤Ä╨▒╨░╤Å ╨╖╨░╨│╤Ç╤â╨╖╨║╨░, ╨▓╨║╨╗╤Ä╤ç╨░╤Å ╤ä╨╛╨╜╨╛╨▓╤â╤Ä.

### 4. ╨ù╨░╤ç╨╡╨╝ ╨╜╤â╨╢╨╜╨░ ╤ä╨░╨▒╤Ç╨╕╨║╨░ ╨║╨╗╤Ä╤ç╨╡╨╣?

╨ª╨╡╨╜╤é╤Ç╨░╨╗╨╕╨╖╨╛╨▓╨░╨╜╨╜╨╛╨╡ ╤â╨┐╤Ç╨░╨▓╨╗╨╡╨╜╨╕╨╡, ╤é╨╛╤ç╨╡╤ç╨╜╨░╤Å ╨╕╨╜╨▓╨░╨╗╨╕╨┤╨░╤å╨╕╤Å, ╤é╨╕╨┐╨╛╨▒╨╡╨╖╨╛╨┐╨░╤ü╨╜╨╛╤ü╤é╤î.

### 5. ╨º╤é╨╛ ╤é╨░╨║╨╛╨╡ ╤ü╨╡╨╗╨╡╨║╤é╨╛╤Ç ╨▓ useQuery?

╨ñ╤â╨╜╨║╤å╨╕╤Å ╨┤╨╗╤Å ╨┐╨╛╨┤╨┐╨╕╤ü╨║╨╕ ╤é╨╛╨╗╤î╨║╨╛ ╨╜╨░ ╨╜╤â╨╢╨╜╤â╤Ä ╤ç╨░╤ü╤é╤î ╨┤╨░╨╜╨╜╤ï╤à, ╨╛╨┐╤é╨╕╨╝╨╕╨╖╨╕╤Ç╤â╨╡╤é ╤Ç╨╡╤Ç╨╡╨╜╨┤╨╡╤Ç╤ï.
