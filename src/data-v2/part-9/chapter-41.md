# Глава 41. Сборка: что это и зачем нужно

Главная идея сборщика — превратить исходный код в быстрый, готовый к продакшену бандл. Не важно, Vite это или Webpack — смысл один.

---

## 41.1. Что делает сборщик

Сборка — это набор шагов:

1. Читает исходники.
2. Преобразует современный JS/TS в совместимый.
3. Склеивает модули в чанки.
4. Удаляет лишнее и минифицирует.

Результат — быстрый старт страницы и меньше ошибок в проде.

---

## 41.2. Dev сервер vs Production сборка

- **Dev**: быстрый старт, горячая замена модулей (HMR), всё для скорости разработки.
- **Prod**: максимальная оптимизация, минификация, tree-shaking, стабильные чанки.

---

## 41.3. Vite, Webpack, Turbopack — суть различий

### Vite
- Очень быстрый dev сервер за счёт ESM.
- Отличен для новых проектов.
- В продакшене использует Rollup.

### Webpack
- Гибкий и зрелый, но тяжелее в настройке.
- Нужен для legacy и нестандартных кейсов.

### Turbopack
- Родной для Next.js, делает dev режим очень быстрым.
- Экосистема ещё растёт, но перспективен.

---

## 41.4. Где в этом Babel и TypeScript

- **TypeScript** отвечает за типы, а не за сборку.
- **Babel/esbuild** преобразуют синтаксис.
- В современных инструментах это «встроено», поэтому отдельный конфиг не нужен почти никогда.

Минимальная практическая формула:

```
TypeScript → (Babel/esbuild) → Bundler → Prod-чанки
```

---

## 41.5. Как выбрать инструмент

- **Next.js** → Turbopack (или Webpack по умолчанию).
- **Новый SPA** → Vite.
- **Сложная/старая система** → Webpack.

Главный критерий — требования проекта, а не модность инструмента.

---

## 41.6. Что именно оптимизирует сборщик

- Разделяет код на чанки по страницам и фичам.
- Удаляет неиспользуемые экспорты.
- Минифицирует JS и CSS.
- Упорядочивает порядок загрузки ресурсов.
- Стабилизирует имена файлов для кеширования.

Эти шаги напрямую влияют на скорость первого экрана и повторные визиты.

---

## 41.7. Кэш и повторные сборки

Для больших проектов важно, как быстро пересобирается проект:

- Dev сборка должна быть быстрой, даже если prod сборка дольше.
- Инкрементальные сборки экономят часы в больших репозиториях.
- Полная очистка кеша нужна только при странных ошибках, а не «по привычке».

---

## 41.8. Source maps и дебаг

Source maps — это возможность видеть исходный код в продакшене при ошибках.

- Включай sourcemaps в staging.
- В проде включай только если есть безопасный доступ.
- Для публичных приложений разумно ограничивать детализацию.

---

## 41.9. Когда важно менять инструмент

Менять сборщик стоит только если:

- скорость сборки тормозит команду,
- нужна специфичная функциональность,
- текущий инструмент упирается в ограничения.

Если проблемы нет — миграция не даёт ценности.

---

## 41.10. Мини-чек-лист для проекта

- Выбран инструмент и версия.
- Настроены окружения dev/prod.
- Понимание, где включены sourcemaps.
- Бандл анализируется перед релизом.
- У команды есть единые правила сборки.

