# Глава 41. Сборка: что это и зачем нужно

Представь сборщик как переводчика и логиста в одном лице. Он берет твой современный, понятный человеку код — с TypeScript, JSX, импортами модулей — и превращает его в компактные чанки, которые браузер сможет проглотить максимально быстро. При этом он делает это так, чтобы твоя страница загружалась мгновенно, а пользователь не ждал.

---

## 41.1. Что делает сборщик

Сборка — это не просто «склеить файлы». Это многошаговый процесс, который превращает исходники в продакшен-готовый код.

Сборщик читает твой код, понимает зависимости между модулями, преобразует современный JavaScript и TypeScript в совместимый с браузерами формат, склеивает модули в оптимальные чанки, удаляет всё лишнее и минифицирует результат. Всё это для того, чтобы страница загружалась быстро, а пользователь не чувствовал ожидания.

Результат — быстрый старт страницы и меньше ошибок в проде, потому что сборщик ловит проблемы на этапе сборки, а не в браузере пользователя.

---

## 41.2. Dev сервер vs Production сборка

В режиме разработки тебе нужна скорость: ты меняешь код, и изменения должны появляться мгновенно. Dev сервер даёт тебе горячую замену модулей (HMR) — когда ты меняешь компонент, обновляется только он, а не вся страница. Это делает цикл разработки быстрым и приятным.

В продакшене приоритеты другие: максимальная оптимизация, минификация, tree-shaking, стабильные чанки с предсказуемыми именами для кеширования. Здесь скорость сборки менее важна, чем качество результата.

---

## 41.3. Vite, Webpack, Turbopack: выбор между современным быстрым стартом и мощным комбайном

Выбор сборщика — это не про то, какой инструмент «лучше». Это про то, какую задачу ты решаешь.

**Vite** — это современный быстрый старт. Он использует нативные ES модули в dev режиме, поэтому сервер запускается мгновенно, а изменения применяются без перезагрузки страницы. В продакшене он использует Rollup для создания оптимизированных бандлов. Отличный выбор для новых проектов, где важна скорость разработки.

**Webpack** — это мощный комбайн для сложных систем. Он гибкий, зрелый, с огромной экосистемой плагинов, но тяжелее в настройке. Если у тебя нестандартные требования, legacy-код или сложная архитектура, Webpack даст тебе контроль над каждым шагом сборки.

**Turbopack** — это родной сборщик для Next.js, написанный на Rust. Он делает dev режим очень быстрым даже на больших проектах. Экосистема ещё растёт, но для Next.js проектов это перспективный выбор.

---

## 41.4. Где в этом Babel и TypeScript

Важно понимать роли инструментов. **TypeScript** отвечает за типы — он проверяет твой код на этапе разработки, но не собирает его. Сборку делает транспайлер: **Babel** или **esbuild**.

В современных инструментах (Vite, Next.js) это всё «встроено», поэтому отдельный конфиг не нужен почти никогда. Ты просто пишешь TypeScript и JSX, а сборщик сам разбирается, что с этим делать.

Минимальная практическая формула:

```
TypeScript → (Babel/esbuild) → Bundler → Prod-чанки
```

---

## 41.5. Как выбрать инструмент

Выбор зависит от проекта:

- **Next.js** → Turbopack (или Webpack по умолчанию)
- **Новый SPA** → Vite
- **Сложная/старая система** → Webpack

Главный критерий — требования проекта, а не модность инструмента. Если текущий сборщик решает твои задачи и не тормозит команду, менять его «просто потому что» не стоит.

---

## 41.6. Что именно оптимизирует сборщик

Сборщик делает несколько вещей, которые напрямую влияют на скорость первого экрана:

- Разделяет код на чанки по страницам и фичам, чтобы пользователь загружал только то, что нужно сейчас.
- Удаляет неиспользуемые экспорты (tree-shaking), уменьшая размер бандла.
- Минифицирует JS и CSS, убирая пробелы, комментарии и сокращая имена переменных.
- Упорядочивает порядок загрузки ресурсов для оптимальной производительности.
- Стабилизирует имена файлов для кеширования, чтобы браузер мог эффективно использовать кеш.

Эти шаги напрямую влияют на скорость первого экрана и повторные визиты.

---

## 41.7. Кэш и повторные сборки

Для больших проектов важно, как быстро пересобирается проект после изменений. Dev сборка должна быть быстрой, даже если prod сборка занимает больше времени. Инкрементальные сборки экономят часы в больших репозиториях — сборщик пересобирает только изменённые части, а не всё с нуля.

Полная очистка кеша нужна только при странных ошибках, а не «по привычке». Кеш — это не враг, это инструмент ускорения.

---

## 41.8. Source maps и дебаг

Source maps — это возможность видеть исходный код в продакшене при ошибках. Без них ты увидишь минифицированный код, который невозможно читать.

Включай sourcemaps в staging, чтобы отлаживать проблемы перед релизом. В проде включай только если есть безопасный доступ — sourcemaps могут раскрыть структуру кода. Для публичных приложений разумно ограничивать детализацию.

---

## 41.9. Когда важно менять инструмент

Менять сборщик стоит только если:

- скорость сборки тормозит команду (люди ждут по 5-10 минут каждый раз);
- нужна специфичная функциональность, которую текущий инструмент не поддерживает;
- текущий инструмент упирается в ограничения, которые нельзя обойти.

Если проблемы нет — миграция не даёт ценности. «Потому что новый инструмент быстрее» — не причина, если текущий и так справляется.

---

## 41.10. Мини-чек-лист для проекта

Убедись, что:

- Выбран инструмент и версия, и это зафиксировано в документации.
- Настроены окружения dev/prod с правильными оптимизациями.
- Понимание, где включены sourcemaps и зачем.
- Бандл анализируется перед релизом (размер, состав чанков).
- У команды есть единые правила сборки, все знают, как запускать проект.

Этого достаточно, чтобы сборка не превратилась в источник проблем.
