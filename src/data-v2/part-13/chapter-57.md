# Глава 57. Маршрутизация и компоновка в App Router

В App Router маршруты и компоновка строятся файловой структурой. Главное — понимать порядок: **сегменты → layout/template → состояния (loading/error/not-found) → расширенные сценарии**.

---

## 57.1. Базовая маршрутизация

- `app/page.tsx` → `/`
- `app/products/page.tsx` → `/products`
- `app/products/[id]/page.tsx` → `/products/:id`
- `app/docs/[...slug]/page.tsx` → `/docs/*`

Это всё, что нужно для старта.

---

## 57.2. Layout и Template — в чём реальный смысл

### layout.tsx

- Не размонтируется при навигации.
- Сохраняет состояние.
- Используется для общих частей (header, sidebar, навигация).

### template.tsx

- Создаёт **новый экземпляр** при каждой навигации.
- Сбрасывает локальное состояние.
- Полезен для анимаций переходов или сценариев «с чистого листа».

Коротко: **layout — постоянный каркас, template — временная оболочка**.

---

## 57.3. Loading, Error, Not Found

- `loading.tsx` — показывается, пока сегмент грузится.
- `error.tsx` — ловит ошибки внутри сегмента (это Client Component).
- `not-found.tsx` — 404 внутри сегмента или глобально.

Эти файлы дают контролируемый UX без ручной логики.

---

## 57.4. Группы и параллельные маршруты

### Route Groups `(group)`

Позволяют организовать код, **не влияя на URL**:

```
app/(marketing)/about/page.tsx → /about
```

### Parallel Routes `@slot`

Нужны, когда внутри одного layout нужно рендерить несколько независимых веток (например контент + панель).

---

## 57.5. Intercepting Routes (перехват)

Это способ открывать модальные окна поверх текущей страницы, сохраняя URL.

Пример сценария: список товаров → открываем карточку в модалке, но URL меняется как у страницы товара.

Синтаксис:

- `(.)` — перехват на том же уровне
- `(..)` — на уровень выше
- `(...)` — от корня

Используй это для модалок и «quick view» без полной навигации.

---

## 57.6. Как Next.js ищет файлы

Порядок важен, иначе будет путаница:

- `page.tsx` — всегда конечная страница.
- `layout.tsx` — общий каркас сегмента.
- `template.tsx` — перезапускает состояние при навигации.
- `loading.tsx` — «скелет» на время ожидания.
- `error.tsx` — локальный error boundary.
- `not-found.tsx` — локальная 404.

Это стандартные точки управления UX.

---

## 57.7. Когда нужен template, а когда нет

`template.tsx` полезен, если:

- важны анимации между страницами,
- нужно сбрасывать локальное состояние при каждом переходе,
- нельзя сохранять старую форму/фильтры.

Если состояние нужно сохранять — используй `layout.tsx`.

---

## 57.8. Loading как часть UX

Loading — это не «про заглушку», а про контроль ожидания:

- делай скелет, похожий на реальный контент,
- показывай загрузку только там, где есть задержка,
- избегай «мигания» при быстром переходе.

---

## 57.9. Error vs Not Found

- `error.tsx` — ошибка внутри сегмента, обычно техническая.
- `not-found.tsx` — нормальная ситуация «данные не найдены».

Это разные сценарии и они должны выглядеть по-разному.

---

## 57.10. Практика для больших приложений

- Route groups помогают разделить маркетинг и продукт.
- Parallel routes удобны для панелей и табов.
- Intercepting routes нужны для модалок без потери контекста.

Используй сложные фичи только когда они дают явную пользу.