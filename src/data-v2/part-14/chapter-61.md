# Глава 61. Безопасность на проекте: ввод, контент, секреты

Эта глава — короткий практический слой поверх теории: что реально важно при работе с продуктом.

---

## 61.1. Пользовательский ввод

- Валидируй данные и на клиенте, и на сервере.
- Никогда не вставляй пользовательский HTML без санитизации.
- Избегай `dangerouslySetInnerHTML`, если нет строгой необходимости.

---

## 61.2. Контент и файлы

- Проверяй тип, размер и расширение загрузок.
- Отдавай пользовательский контент через отдельный домен/поддомен.
- Не доверяй `file.name` и метаданным — всё экранируй.

---

## 61.3. Секреты и переменные окружения

- В клиентском коде **нет секретов**.
- Всё, что начинается с `NEXT_PUBLIC_`, доступно в браузере.
- Токены и ключи держим на сервере или в защищённых куках.

---

## 61.4. Мини-чек-лист

- Валидация + санитизация ввода.
- CSP и безопасные заголовки на сервере.
- Секреты только на сервере.

---

## 61.5. Валидация и санитизация

Валидация отвечает на вопрос «можно ли», санитизация — «как безопасно показать».

- Валидируй структуру и типы.
- Санитизируй HTML, если он неизбежен.
- Не смешивай эти два шага.

---

## 61.6. Хранение токенов

- Не храни access token в `localStorage`.
- Используй HttpOnly cookies, если есть возможность.
- Если используешь память — продумай обновление токенов.

Это снижает риск XSS-утечек.

---

## 61.7. Безопасные заголовки (минимум)

Базовый набор на сервере:

- CSP (ограничить источники скриптов).
- `X-Content-Type-Options: nosniff`.
- `Referrer-Policy: strict-origin-when-cross-origin`.

Эти вещи не делают проект «идеальным», но снимают базовые риски.

---

## 61.8. Работа с контентом

- Не рендери HTML из внешних источников без проверки.
- Для пользовательского контента лучше Markdown + санитизация.
- Для файлов всегда проверяй тип и размер.

---

## 61.9. Мини-набор практики

- Есть список источников данных и их уровень доверия.
- Определён способ хранения токенов.
- Есть правила для пользовательского контента.

Это и есть «безопасность на проекте».

---

## 61.10. Аутентификация и сессии

- Сессия должна иметь срок жизни.
- Обновление токена должно быть прозрачным для пользователя.
- Выход из аккаунта должен очищать все чувствительные данные.

---

## 61.11. Зависимости и supply chain

- Обновляй зависимости регулярно, но аккуратно.
- Избегай малоизвестных пакетов без репутации.
- Проверяй зависимости на уязвимости перед релизом.

---

## 61.12. Логи и мониторинг

- Ошибки должны логироваться на сервере.
- Чувствительные данные не должны попадать в логи.
- Мониторинг нужен, чтобы реагировать быстро.

---

## 61.13. Обработка критических ошибок

- Падение — это сценарий, его нужно проектировать.
- Покажи пользователю понятное сообщение.
- Сохрани важные данные, если это возможно.

---

## 61.14. Чек-лист перед релизом

- Проверены правила хранения токенов.
- Валидация и санитизация включены.
- Логи не содержат чувствительных данных.
- CSP и заголовки включены.
