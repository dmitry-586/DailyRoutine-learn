# Глава 17. Основы React

React — это не фреймворк «для UI», а библиотека для декларативного описания интерфейсов, основанная на идее, что UI — это функция от состояния.

На собеседованиях по React в первую очередь проверяют:

- понимание модели рендеринга
- отличие Virtual DOM от реального DOM
- осознание того, почему React устроен именно так

---

## 17.1. Virtual DOM и Fiber

### Что такое Virtual DOM

Virtual DOM — это объектное представление реального DOM в памяти.

```jsx
const element = <h1>Hello</h1>
```

Под капотом это обычный JS-объект:

```javascript
{
  type: "h1",
  props: { children: "Hello" }
}
```

### Зачем он нужен

Прямые операции с DOM дорогие. React:

1. строит Virtual DOM
2. сравнивает его с предыдущей версией (diffing)
3. минимально обновляет реальный DOM

Это позволяет React эффективно обновлять только изменённые части интерфейса.

### Fiber Architecture

Fiber — это внутренняя архитектура React.

**Что она даёт:**

- приоритеты обновлений
- прерываемый рендеринг
- concurrent features

Проще говоря: React может ставить рендер «на паузу», чтобы интерфейс оставался отзывчивым. Это основа для Suspense, startTransition и других concurrent features.

---

## 17.2. JSX и элементы

JSX — это синтаксический сахар над React.createElement.

### JSX ≠ HTML

```jsx
<div className='box' />
```

- className, а не class
- htmlFor, а не for
- самозакрывающиеся теги обязательны

### Выражения в JSX

```jsx
;<h1>{title.toUpperCase()}</h1>
{
  count > 0 && <span>{count}</span>
}
```

### Условия

```jsx
{
  isOpen && <Modal />
}
{
  isLoading ? <Spinner /> : <Content />
}
```

### Списки и ключи

```jsx
items.map((item) => <li key={item.id}>{item.name}</li>)
```

⚠️ key нужен React, а не вам. Помогает React отслеживать элементы при изменениях списка.

**Правила для key:**

- должен быть уникальным среди siblings
- должен быть стабильным (не меняться между рендерами)
- лучше использовать ID, а не индекс

---

## 17.3. Компоненты и пропсы

### Функциональный компонент

```jsx
function Button({ title, onClick }) {
  return <button onClick={onClick}>{title}</button>
}
```

### Props — только для чтения

```javascript
props.title = 'New' // ошибка концептуально
```

Props должны быть иммутабельными. Изменение props из компонента — антипаттерн.

### Композиция

```jsx
<Card>
  <Button />
</Card>
```

React поощряет композицию, а не наследование. Компоненты можно комбинировать для создания сложных интерфейсов.

### Children

```jsx
function Card({ children }) {
  return <div className='card'>{children}</div>
}
```

**Использование:**

```jsx
<Card>
  <h2>Title</h2>
  <p>Content</p>
</Card>
```

---

## 17.4. Отрисовка и reconciliation

### Процесс рендера

1. Изменилось состояние
2. Компонент перерендерился (вызвалась функция)
3. React сравнил деревья (diffing)
4. Применил минимальные изменения в DOM

### Важно понимать

- рендер ≠ обновление DOM
- рендер — это вызов функции компонента
- React может вызывать компонент много раз
- DOM обновляется только при необходимости

### Частая ошибка

```jsx
function App() {
  fetch('/api') // ❌
  return <div />
}
```

Побочные эффекты нельзя выполнять в теле компонента. Используйте useEffect.

### Контролируемые и неконтролируемые компоненты

**Контролируемые:**

React контролирует значение через state:

```jsx
<input value={value} onChange={(e) => setValue(e.target.value)} />
```

**Неконтролируемые:**

DOM хранит состояние:

```jsx
<input ref={inputRef} defaultValue='initial' />
```

**Когда что использовать:**

- Контролируемые — когда нужен контроль и валидация
- Неконтролируемые — для простых форм, когда производительность важна

---

## Вопросы на собеседовании

### 1. Что такое Virtual DOM?

Объектное представление DOM в памяти. React сравнивает версии и обновляет только изменения.

### 2. Зачем нужен Fiber?

Позволяет прерывать рендеринг, устанавливать приоритеты, реализовывать concurrent features.

### 3. JSX — это HTML?

Нет, это синтаксический сахар над React.createElement. Компилируется в JavaScript.

### 4. Почему key важен?

Помогает React отслеживать элементы в списках, оптимизирует обновления, предотвращает баги.

### 5. Что происходит при изменении state?

Компонент перерендеривается, React сравнивает Virtual DOM, обновляет реальный DOM при необходимости.

### 6. Чем рендер отличается от обновления DOM?

Рендер — вызов функции компонента. Обновление DOM — физическое изменение в браузере. Рендер не всегда приводит к обновлению DOM.

### 7. Почему нельзя делать side effects в теле компонента?

Компонент может рендериться много раз, эффекты будут выполняться каждый раз, что приводит к багам и проблемам производительности.

### 8. Композиция vs наследование?

React поощряет композицию. Компоненты комбинируются для создания сложных интерфейсов.

---

## Key Takeaways

- Virtual DOM оптимизирует обновления DOM
- Fiber позволяет прерывать рендеринг и устанавливать приоритеты
- JSX компилируется в React.createElement
- Props иммутабельны, компоненты композируемы
- Рендер ≠ обновление DOM
- Побочные эффекты в useEffect, не в теле компонента
- Key важен для списков
- React поощряет композицию, а не наследование

---

**Часть VI. React и современная разработка SPA**
