# Глава 1. Как работает Интернет

Интернет кажется магией: ты вводишь в адресной строке "google.com" — и через долю секунды видишь страницу. На самом деле внутри происходит цепочка процессов, и если их понять, весь фронтенд становится куда логичнее: рендеринг, производительность, ошибки сети, кэш, CORS, WebSockets — всё это начинает складываться в цельную картину.

Для фронтенд-разработчика важно понимать это достаточно глубоко, чтобы:

- грамотно объяснять сетевые проблемы
- понимать задержки доставки данных
- диагностировать производительность
- понимать ограничения браузера
- уверенно отвечать на собеседованиях уровня Middle+

---

## 1.1. Архитектура сети

Когда разработчик открывает браузер и вводит URL — кажется, что «страница просто загружается». На самом деле за этим стоит сложная, многоуровневая архитектура:

- физические сети (оптика, медные кабели, беспроводные сети)
- провайдеры и магистральные маршрутизаторы
- протоколы передачи данных
- система адресации (IP)
- система доменных имён (DNS)
- стек TCP/IP
- протоколы прикладного уровня (HTTP, TLS, WebSocket и др.)

### Как устроен Интернет

Интернет — это не «глобальный сервер», а сеть сетей. Тысячи автономных систем (AS — Autonomous Systems) соединены между собой через протокол BGP.

**Условная модель:**

Ваш компьютер → Домашний роутер → Провайдер (ISP) → Магистральные маршрутизаторы → Дата-центр / Сервер / CDN

Каждый переход — это hop. Количество hop влияет на задержку (latency).

---

## 1.2. DNS, IP, TCP/UDP

Когда пользователь вводит `https://example.com`, запускается цепочка сетевых операций.

### DNS — система доменных имён

DNS — это «телефонный справочник Интернета». Он превращает доменное имя в IP-адрес.

**Процесс DNS-lookups:**

1. Браузер проверяет локальный кэш
2. Система (OS) проверяет свой кэш
3. Обращение к DNS-серверу провайдера
4. Если нет записи — запрос к корневому серверу
5. Дальше — к серверу зоны (.com)
6. Потом — к авторитетному серверу домена
7. Возвращается IP-адрес

Обычно нужно 20–120 мс, и это влияет на TTFB и производительность.

### IP — адресация в сети

IP-адрес — это «номер квартиры» в огромном доме Интернета.

**Примеры:**

- IPv4: `192.168.0.1`
- IPv6: `2001:db8::ff00:42:8329`

IPv6 решает проблему нехватки адресов и уменьшает количество hop.

### TCP — надёжный транспорт

TCP обеспечивает:

- гарантированную доставку
- контроль последовательности
- контроль потерь
- повторную отправку пакетов

Это похоже на отправку посылки с квитанцией о получении.

Но! TCP создаёт задержку, потому что устанавливает трёхстороннее рукопожатие: `SYN → SYN-ACK → ACK`

Это иногда +100 мс к первому запросу.

### UDP — быстрый транспорт

UDP — простой и быстрый протокол без гарантий.

Используется для:

- стриминга
- WebRTC
- игр
- DNS

QUIC (HTTP/3) работает поверх UDP.

---

## 1.3. HTTP/1.1 vs HTTP/2 vs HTTP/3

### HTTP/1.1

- последовательные запросы
- head-of-line blocking
- нужно много TCP-соединений
- нагрузки на сервер больше

Браузер открывает до 6 соединений на домен. Каждое соединение может обрабатывать только один запрос за раз. На медленных сетях это катастрофа.

### HTTP/2

Решает ключевые проблемы:

- мультиплексирование (несколько запросов в одном TCP)
- сервер пушит данные (Server Push)
- бинарный протокол
- сжатие заголовков (HPACK)

**Проблема:** TCP всё ещё медленный при потерях.

### HTTP/3 (QUIC)

- работает поверх UDP
- каждый HTTP-поток — независимый
- потери не блокируют остальные запросы
- 0-RTT для повторных подключений (после первого handshake)
- меньше задержек в мобильных сетях

Сегодня HTTP/3 даёт лучшую стабильность и скорость, особенно на мобильных.

---

## 1.4. HTTPS и TLS Handshake

`HTTPS = HTTP + TLS (шифрование)`

**Процесс установки защищённого соединения:**

1. Клиент отправляет список поддерживаемых алгоритмов
2. Сервер выбирает алгоритм и отправляет сертификат
3. Клиент проверяет сертификат (trusted CA)
4. Обмениваются ключами
5. Устанавливается шифрованный канал

**Проблема:** это обычно добавляет 1 RTT (round-trip time)

В HTTP/3 это оптимизировано.

---

## 1.5. Цикл запрос–ответ

Упрощённая цепочка:

1. Ввод URL
2. DNS запрос
3. Установление TCP/TLS
4. Отправка HTTP-запроса
5. Сервер формирует ответ
6. Клиент получает данные
7. Рендер страницы

Интервьюеры любят спрашивать: «Что происходит от момента, когда вы нажимаете Enter?»

---

## 1.6. Методы HTTP и идемпотентность

### Методы

- **GET** — без побочных эффектов
- **POST** — создаёт данные
- **PUT** — заменяет
- **PATCH** — частично обновляет
- **DELETE** — удаляет

### Идемпотентность

Идемпотентный запрос можно повторить без изменения результата.

- GET — да
- PUT — да
- DELETE — обычно да
- POST — нет

На собеседованиях любят задавать вопрос про PUT vs PATCH.

---

## 1.7. Коды состояния HTTP

**Группы:**

- 1xx — информационные
- 2xx — успех
- 3xx — редиректы
- 4xx — ошибка клиента
- 5xx — ошибка сервера

**Важно знать:**

- `200 OK`
- `201 Created`
- `301/302 Redirect`
- `304 Not Modified` (не скачивай, у тебя есть свежая копия)
- `400 Bad Request`
- `401/403 Authorization`
- `404 Not Found`
- `429 Too Many Requests` (лимиты запросов)
- `500 Internal Error`
- `503 Service Unavailable`

---

## 1.8. REST, SOAP, GraphQL, gRPC

**REST**

- Особенности: простота, ресурсы, HTTP
- Где используется: классические API

**SOAP**

- Особенности: XML, строгая схема
- Где используется: банки, корпорации

**GraphQL**

- Особенности: один endpoint, декларативность
- Где используется: фронтенд-heavy приложения

**gRPC**

- Особенности: бинарный протокол, очень быстро
- Где используется: микросервисы

На фронтенд собеседованиях GraphQL спрашивают регулярно.

---

## 1.9. CORS и Same-Origin Policy

### Same-Origin Policy

`origin = protocol + domain + port`

**Пример:**

- `https://example.com:443`
- `http://example.com:80` → другой origin
- `https://api.example.com` → другой origin

CORS — механизм, позволяющий частично ослаблять это правило.

**Важно:** CORS настраивает сервер, а не браузер. Браузер лишь исполняет политику сервера.

---

## 1.10. WebSockets и SSE

### WebSocket

- двусторонняя связь
- постоянное соединение
- чаты, игровая логика

**Пример:**

```javascript
const ws = new WebSocket('wss://echo.example')
ws.onmessage = (e) => console.log(e.data)
ws.send('Привет')
```

### SSE (Server-Sent Events)

- односторонний поток от сервера к клиенту
- легче, чем WebSocket
- автоматическое переподключение
- дешевле по ресурсам

Как радио: сервер говорит, клиент слушает.

---

## Вопросы на собеседовании

### 1. Опишите, что происходит, когда пользователь вводит URL в браузер

Короткий и хороший ответ:

1. Проверка кэша
2. DNS-резолв
3. TCP-handshake
4. TLS-handshake (если HTTPS)
5. HTTP-запрос → HTML
6. Парсинг HTML → DOM
7. Загрузка CSS/JS
8. Рендеринг

### 2. В чём отличие HTTP/1.1, HTTP/2 и HTTP/3?

- HTTP/1.1 — много соединений, блокировки
- HTTP/2 — одно соединение, мультиплексирование
- HTTP/3 — QUIC/UDP, меньше задержек, устойчивость при потере пакетов

### 3. Что такое DNS и зачем он нужен?

DNS — система доменных имён, превращающая доменное имя в IP-адрес. Это «телефонный справочник Интернета».

### 4. Чем TCP отличается от UDP?

TCP — надёжный протокол с гарантией доставки, но с задержками из-за handshake. UDP — быстрый, без гарантий, используется для стриминга и игр.

### 5. Что такое TLS Handshake?

Процесс установки защищённого соединения, включающий обмен сертификатами и ключами. Обычно добавляет 1 RTT к первому запросу.

### 6. Что такое идемпотентность?

Свойство запроса, позволяющее повторять его без изменения результата. GET, PUT, DELETE — идемпотентны, POST — нет.

### 7. Что такое CORS?

Cross-Origin Resource Sharing — механизм, позволяющий ослаблять Same-Origin Policy. Настраивается на сервере.

### 8. Чем WebSocket отличается от SSE?

- WebSocket — двустороннее общение
- SSE — только сервер → клиент
- SSE проще, WS мощнее

---

## Key Takeaways

- Интернет — это набор уровней: DNS, TCP, TLS, HTTP.
- Самые дорогие операции — DNS и handshakes.
- HTTP/2 и HTTP/3 радикально ускоряют загрузку.
- HTTPS обязателен — это не роскошь.
- CORS — серверная политика, браузер лишь её исполняет.
- WebSocket — для диалога, SSE — для трансляций.
- Понимание сетевого стека — важный навык middle/senior разработчика.

---

**Часть I. Фундамент веба**
